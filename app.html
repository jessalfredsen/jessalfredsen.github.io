<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                colors: {
                    'blue': '#1fb6ff',
                    'purple': '#7e5bef',
                    'pink': '#ff49db',
                    'orange': '#ff7849',
                    'green': '#13ce66',
                    'yellow': '#ffc82c',
                    'gray-dark': '#273444',
                    'gray': '#8492a6',
                    'gray-light': '#d3dce6',
                },
                fontFamily: {
                    sans: ['Graphik', 'sans-serif'],
                    serif: ['Merriweather', 'serif'],
                },
                extend: {
                    spacing: {
                        'xl': '48rem',
                        '8xl': '96rem',
                        '9xl': '128rem',
                    },
                    borderRadius: {
                        '4xl': '2rem',
                    }
                }
            }
        }
    </script>

</head>

<body>
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
        <div class="md:flex">
            <div class="p-8">
                <div class="uppercase tracking-wide text-sm text-indigo-500 font-semibold">CodeComplianceChecker
                </div>
                <a href="#" class="block mt-1 text-lg leading-tight font-medium text-black hover:underline">A great
                    app
                    for helping you stay up to date with your compliance processes</a>
                <p class="mt-2 text-slate-500">The app just scans through you code and reminds you to update stale
                    or
                    outdated compliance documents.</p>
            </div>
        </div>
    </div>
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
        <div class="md:flex">
            <div class="p-8">
                <div class="uppercase tracking-wide text-sm text-indigo-500 font-semibold">Access token:
                </div>
                <p id="access_token_field" class="mt-2 text-slate-500"></p>
            </div>
        </div>
    </div>
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
        <div class="md:flex">
            <div class="p-8">
                <div class="uppercase tracking-wide text-sm text-indigo-500 font-semibold">Logged in user:
                </div>
                <p id="user_display_name" class="mt-2 text-slate-500"></p>
            </div>
        </div>
    </div>
    <div class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl">
        <div class="md">
            <div class="p-8">
                <div class="uppercase tracking-wide text-sm text-indigo-500 font-semibold">Files
                </div>
                <ul class="max-w-md divide-y divide-gray-200 dark:divide-gray-700">
                    <li class="pb-3 sm:pb-4">
                        <div class="flex items-center space-x-4">
                            <div class="flex-shrink-0">
                                <img class="w-8 h-8 rounded-full" src="/images/avatar.svg"
                                    alt="Neil image">
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900 truncate dark:text-white">
                                    Neil Sims
                                </p>
                                <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                                    email@flowbite.com
                                </p>
                            </div>
                            <div class="inline-flex items-center text-base font-semibold text-gray-900 dark:text-white">
                                $320
                            </div>
                        </div>
                    </li>
                    <li class="py-3 sm:py-4">
                        <div class="flex items-center space-x-4">
                            <div class="flex-shrink-0">
                                <img class="w-8 h-8 rounded-full" src="/images/avatar.svg"
                                    alt="Neil image">
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900 truncate dark:text-white">
                                    Bonnie Green
                                </p>
                                <p class="text-sm text-gray-500 truncate dark:text-gray-400">
                                    email@flowbite.com
                                </p>
                            </div>
                            <div class="inline-flex items-center text-base font-semibold text-gray-900 dark:text-white">
                                $3467
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>

    </div>

    <script>
        const params = new Proxy(new URLSearchParams(window.location.hash.substring(1)), {
            get: (searchParams, prop) => searchParams.get(prop),
        });
        
        document.getElementById("user_display_name").innerText = '';
        document.getElementById("access_token_field").innerText = 'Not set';
        
        if (params.access_token != undefined) {
            console.log('Setting access token')
            document.getElementById("access_token_field").innerText = params.access_token;

            // Call MS Graph
            const userAction = async () => {
                console.log('going to call somehting')
                const response = await fetch('https://graph.microsoft.com/v1.0/me', {
                    headers: {
                        'Authorization': 'Bearer ' + params.access_token
                    }
                });
                console.log(response)
                const myJson = await response.json(); //extract JSON from the http response
                console.log(myJson)
                // do something with myJson
                document.getElementById("user_display_name").innerText = myJson['displayName'];
            }
            userAction();

        }

    </script>
</body>

</html>